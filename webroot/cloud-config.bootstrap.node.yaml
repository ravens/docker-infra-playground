#cloud-config
write_files:
  - path: /mnt/rancher-os.yaml
    permissions: "0755"
    owner: root
    content: |
      #cloud-config
      rancher:
        cloud_init:
          datasources: 
           - url:http://192.168.25.3/cloud-config.node.yaml
  - path: /mnt/runme.sh
    permissions: "0755"
    owner: root
    content: |
      #!/bin/sh 
      # Ugly workaround to install rancher on the physical disk. ros install is using disk label to find the ISO...
      wget -O /tmp/rancheros.iso http://192.168.25.3/rancheros.iso
      mkdir -p /mnt/rancherosiso
      losetup /dev/loop0 /tmp/rancheros.iso
      mount /dev/loop0 /mnt/rancherosiso
      ros install -f -c /mnt/rancher-os.yaml -d /dev/sda 
      reboot
runcmd:
- sudo /mnt/runme.sh